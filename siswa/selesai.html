<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Ujian Selesai</title>
<link rel="stylesheet" href="../assets/css/admin.css">
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    margin:0; padding:0;
    display:flex; justify-content:center; align-items:center;
    height:100vh;
  }
  .card {
    background:#fff;
    padding:30px 40px;
    border-radius:10px;
    box-shadow:0 3px 10px rgba(0,0,0,0.1);
    text-align:center;
    max-width:500px;
  }
  h1 { color:#3b82f6; margin-bottom:20px; }
  .emoji {
    font-size:5rem;
    margin-bottom:20px;
    display:block;
    animation: bounce 1s infinite;
  }
  p { font-size:1.1rem; margin-bottom:30px; }
  a.btn {
    display:inline-block;
    background:#3b82f6;
    color:#fff;
    padding:12px 25px;
    border-radius:6px;
    text-decoration:none;
    font-weight:bold;
    transition:0.3s;
  }
  a.btn:hover { background:#2563eb; }

  /* Animasi emoji */
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-15px); }
  }
</style>
</head>
<body>

<div class="card">
  <span class="emoji" id="emoji">üòÑ</span>
  <h1>Ujian Selesai</h1>
  <p id="pesan">Terima kasih telah menyelesaikan ujian.<br>Jawabanmu telah tersimpan dan akan dinilai oleh guru.</p>
  <!-- Tombol kembali ke login -->
  <a href="../login-siswa.html" class="btn"><i class="fa fa-sign-in"></i> Kembali ke Login</a>
</div>

<script type="module">
import { db } from "../assets/js/firebase.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const siswaUid  = sessionStorage.getItem("siswaUid");
const kodeUjian = sessionStorage.getItem("kodeUjian");

const emojiEl  = document.getElementById("emoji");
const pesanEl  = document.getElementById("pesan");
const statusEl = document.getElementById("status");

// Default
statusEl.textContent = "‚è≥ Memverifikasi jawaban di server...";
statusEl.style.color = "#f59e0b";

if (!siswaUid || !kodeUjian) {
  window.location.href = "../login-siswa.html";
}

try {
  const ref = doc(db, "jawaban_siswa", `${siswaUid}_${kodeUjian}`);
  const snap = await getDoc(ref);

  if (snap.exists()) {
    const data = snap.data();

    // ‚úÖ STATUS BERHASIL
    statusEl.textContent = "‚úÖ Jawaban berhasil tersimpan di Firebase";
    statusEl.style.color = "#16a34a";

    // Ambil nilai (sesuai struktur kamu)
    const skor = data.totalNilai ?? null;

    if (skor !== null) {
      if (skor < 50) emojiEl.textContent = "üò¢";
      else if (skor <= 75) emojiEl.textContent = "üôÇ";
      else emojiEl.textContent = "üòÑ";

      pesanEl.innerHTML = `
        Terima kasih telah menyelesaikan ujian.<br>
        Nilai sementara: <b>${skor}</b>
      `;
    }

  } else {
    // ‚ùå DATA TIDAK DITEMUKAN
    emojiEl.textContent = "‚ö†Ô∏è";
    statusEl.textContent = "‚ùå Jawaban belum ditemukan di server";
    statusEl.style.color = "#dc2626";

    pesanEl.innerHTML = `
      Jawaban tidak ditemukan di database.<br>
      Silakan hubungi pengawas atau guru.
    `;
  }

} catch (err) {
  console.error(err);
  emojiEl.textContent = "‚ùå";
  statusEl.textContent = "Gagal menghubungi server Firebase";
  statusEl.style.color = "#dc2626";
}
</script>


</body>
</html>
